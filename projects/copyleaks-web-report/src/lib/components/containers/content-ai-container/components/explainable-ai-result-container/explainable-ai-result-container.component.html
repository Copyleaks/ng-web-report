<div class="top-container" [class.empty-view]="emptyView" [class.locked-view]="lockedResults" fxLayout="column">
	<ng-container *ngIf="!isLoading; else loadingState">
		<div class="top-header-container">
			<div
				class="header-container"
				[class.header-container-mobile]="isMobile && !lockedResults"
				fxLayout="column"
				fxLayoutGap="4px">
				<!-- Header -->
				<div *ngIf="!emptyView" class="header" fxLayout="row" fxLayoutAlign="space-between center">
					<span class="title">
						{{ title }}
					</span>
					<div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="8px">
						<div *ngIf="!emptyView && !lockedResults && !isMobile" class="beta-container">
							<span>Beta</span>
						</div>
						<mat-icon
							class="info-icon"
							fontSet="material-icons-outlined"
							[tabIndex]="0"
							#tooltipTitle="matTooltip"
							[matTooltip]="infoTooltipText"
							[matTooltipPosition]="'after'"
							(click)="isMobile ? toggleTooltip(tooltipTitle) : ''"
							aria-label="ai result info"
							i18n-aria-label
							aria-hidden="false"
							matTooltipClass="web-report-mat-tooltip tooltip-contanier">
							info
						</mat-icon>
					</div>
				</div>
				<!-- Description and Grade-Bar -->
				<div *ngIf="!emptyView && !lockedResults && !isMobile" fxLayout="column" fxLayoutGap="16px">
					<span class="header-description" i18n>
						GenAI often overuses certain phrases learned during training, which is one of dozens of signals used to
						identify AI text.
					</span>
					<div class="grade-bar-top-container" fxLayout="column" fxLayoutGap="8px">
						<span class="title" i18n>The number of times a phrase was found more frequently in AI vs human text.</span>
						<div
							class="grade-bar-container"
							tabindex="0"
							crAIScoreTooltipContent
							[isTooltipBar]="true"
							[tooltipText]="barTooltipText"
							fxLayout="row"
							fxLayoutAlign="start center"
							fxLayoutGap="16px">
							<span class="min-proportion">{{ minProportion.toLocaleString() }}x</span>
							<div class="grade-bar" fxLayout="row">
								<div class="min-result" [style.width]="minGradeBar + '%'"></div>
								<div class="mid-result" [style.width]="midGradeBar + '%'"></div>
								<div class="max-result" [style.width]="maxGradeBar + '%'"></div>
							</div>
							<ng-container *ngIf="hasInfinityResult; else maxResult">
								<span class="max-proportion">10,000x</span>
							</ng-container>
							<ng-template #maxResult>
								<span class="max-proportion">{{ maxProportion.toLocaleString() }}x</span>
							</ng-template>
						</div>
					</div>
				</div>
			</div>
			<div
				*ngIf="!emptyView && !lockedResults && !isMobile"
				class="result-header"
				fxLayout="row"
				fxLayoutAlign="start center"
				fxLayoutGap="16px">
				<div class="ratio-contanier" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="2px">
					<span i18n>Ratio</span>
					<mat-icon
						class="info-icon"
						fontSet="material-icons-outlined"
						aria-hidden="false"
						[tabIndex]="0"
						[matTooltip]="proportionTooltipText"
						[matTooltipPosition]="'after'"
						matTooltipClass="web-report-mat-tooltip tooltip-contanier">
						info
					</mat-icon>
				</div>
				<span class="phrase" i18n>Phrase</span>
			</div>
		</div>
		<div
			class="container-explain-results"
			[class.explain-results-mobile-container]="isMobile"
			[class.explain-results-mobile-container-height]="isMobile && openedPanel"
			[class.explain-results-mobile-container-padding]="isMobile && lockedResults"
			fxLayout="column">
			<!-- Empty and Locked view -->
			<ng-container *ngIf="emptyView || lockedResults; else showResults">
				<div class="empty-and-locked-contaienr" fxLayout="column" fxLayoutAlign="center center">
					<!-- Empty view -->
					<ng-container *ngIf="emptyView; else lockedResults">
						<div class="empty-contaienr" fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="4px">
							<span class="title" i18n>No AI Insights Were Found</span>
							<span class="description" i18n>
								There is no specific phrase that indicates AI. However, other criteria suggest that this text was
								generated by AI.
							</span>
						</div>
					</ng-container>
					<!-- Locked view -->
					<ng-template #lockedResults>
						<div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="8px">
							<mat-icon class="lock-icon">lock</mat-icon>
							<span i18n>Locked results</span>
						</div>
					</ng-template>
				</div>
			</ng-container>
			<!-- Show results -->
			<ng-template #showResults>
				<!-- Desktop view -->
				<ng-container *ngIf="!isMobile; else mobileView">
					<div #desktopScroll class="desktop-scroll" fxLayout="column">
						<div
							class="explain-results"
							[id]="'result-' + i"
							fxLayout="column"
							*ngFor="let result of explainItemResults; let i = index">
							<ng-container *ngTemplateOutlet="templateResult; context: { item: result, index: i }"></ng-container>
						</div>
					</div>
				</ng-container>
				<!-- Mobile view -->
				<ng-template #mobileView>
					<div #scrollContainer class="mobile-scroll" fxLayout="row" (scroll)="onScrollMobile()">
						<div
							class="explain-results"
							[style.margin-right]="i == explainItemResults.length - 1 ? '0px' : '16px'"
							fxLayout="row"
							*ngFor="let result of explainItemResults; let i = index"
							[attr.data-index]="i">
							<ng-container *ngTemplateOutlet="templateResult; context: { item: result, index: i }"></ng-container>
						</div>
					</div>
				</ng-template>
			</ng-template>
		</div>
		<!-- Mobile navigate buttons -->
		<div
			*ngIf="isMobile && explainItemResults.length > 1"
			class="navigate-mobie-button-contaienr"
			fxLayout="row"
			fxLayoutAlign="center center"
			fxLayoutGap="8px">
			<mat-chip
				*ngIf="explainItemResults.length > 5 && currentViewedIndex > 2"
				role="button"
				(click)="scrollToIndex(0)"
				class="mat-chip-navigate">
				{{
					currentViewedIndex < explainItemResults.length - 3 ? currentViewedIndex - 2 : explainItemResults.length - 5
				}}
			</mat-chip>

			<button
				class="navigate-mobie-button"
				[class.navigate-mobie-button-select]="navigateMobileButton == enumNavigateMobileButton.FirstButton"
				(click)="onDotNavigate(enumNavigateMobileButton.FirstButton)"></button>
			<button
				class="navigate-mobie-button"
				[class.navigate-mobie-button-select]="navigateMobileButton == enumNavigateMobileButton.SecondButton"
				(click)="onDotNavigate(enumNavigateMobileButton.SecondButton)"></button>
			<button
				class="navigate-mobie-button"
				[class.navigate-mobie-button-select]="navigateMobileButton == enumNavigateMobileButton.ThirdButton"
				(click)="onDotNavigate(enumNavigateMobileButton.ThirdButton)"></button>
			<button
				class="navigate-mobie-button"
				[class.navigate-mobie-button-select]="navigateMobileButton == enumNavigateMobileButton.FourthButton"
				(click)="onDotNavigate(enumNavigateMobileButton.FourthButton)"></button>
			<button
				class="navigate-mobie-button"
				[class.navigate-mobie-button-select]="navigateMobileButton == enumNavigateMobileButton.FifthButton"
				(click)="onDotNavigate(enumNavigateMobileButton.FifthButton)"></button>

			<mat-chip
				*ngIf="explainItemResults.length > 5 && currentViewedIndex < explainItemResults.length - 3"
				role="button"
				(click)="scrollToIndex(explainItemResults.length - 1)"
				class="mat-chip-navigate">
				{{
					currentViewedIndex > 2 ? explainItemResults.length - currentViewedIndex - 3 : explainItemResults.length - 5
				}}
			</mat-chip>
		</div>
	</ng-container>
	<ng-template #loadingState>
		<div class="loading-container" fxLayout="column">
			<ng-container *ngIf="!isMobile; else mobileLoading">
				<div class="loading-header-top-container" fxLayout="column" fxLayoutGap="16px">
					<div class="loading-header-container" fxLayout="column" fxLayoutGap="4px">
						<ngx-skeleton-loader
							class="title-loading skeleton skeleton-small-height"
							[appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader
							class="first-description-loading skeleton skeleton-small-height"
							[appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader
							class="second-description-loading skeleton skeleton-small-height"
							[appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-grade-bar-container" fxLayout="column" fxLayoutGap="8px">
						<ngx-skeleton-loader
							class="description-loading skeleton skeleton-small-height"
							[appearance]="'line'"></ngx-skeleton-loader>
						<div fxLayout="column" fxLayoutAlign="start center">
							<ngx-skeleton-loader
								class="grade-bar-loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
						</div>
					</div>
				</div>
				<div class="loading-result-top-container" fxLayout="column">
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-contant-result-container" fxLayout="column" fxLayoutGap="2px">
						<div class="description-loading" fxLayout="column">
							<ngx-skeleton-loader
								class="loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
						</div>
						<div
							class="ai-count-loading-container"
							fxLayout="row"
							fxLayoutAlign="space-between center"
							fxLayoutGap="4px">
							<ngx-skeleton-loader
								class="ai-count-loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
							<ngx-skeleton-loader
								class="result-loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
						</div>
						<div
							class="human-count-loading-container"
							fxLayout="row"
							fxLayoutAlign="space-between center"
							fxLayoutGap="4px">
							<ngx-skeleton-loader
								class="human-count-loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
							<ngx-skeleton-loader
								class="result-loading skeleton skeleton-small-height"
								[appearance]="'line'"></ngx-skeleton-loader>
						</div>
					</div>
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="loading-result-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
				</div>
			</ng-container>
			<ng-template #mobileLoading>
				<div class="mobile-loading-container" fxLayout="column" fxLayoutGap="16px">
					<div class="mobile-header-loading-container">
						<ngx-skeleton-loader class="header-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
					<div class="result-loading-container" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
						<ngx-skeleton-loader class="proportion-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
						<ngx-skeleton-loader class="result-loading skeleton" [appearance]="'line'"></ngx-skeleton-loader>
					</div>
				</div>
			</ng-template>
		</div>
	</ng-template>
</div>

<!-- AI result template -->
<ng-template #templateResult let-item="item" let-index="index">
	<mat-accordion #panels>
		<mat-expansion-panel (opened)="addToPanelIndex(index)" (closed)="removeFromPanelIndex(index)" hideToggle>
			<mat-expansion-panel-header>
				<mat-panel-title>
					<div class="panel-header-container" fxLayout="row" fxLayoutAlign="space-between center" fxLayoutGap="16px">
						<div class="proportion-content-container" fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="16px">
							<div
								class="proportion {{ getProportionClassType(item.proportionType) }}"
								fxLayout="column"
								fxLayoutAlign="center center">
								<ng-container *ngIf="item.isInfinity; else showProportionValue">
									<span class="content">10,000x</span>
								</ng-container>
								<ng-template #showProportionValue>
									<span>{{ item.proportion.toLocaleString() }}x</span>
								</ng-template>
							</div>
							<span
								class="content"
								[class.show-all-text]="isMobile && isPanelOpen(index)"
								crAIScoreTooltipContent
								[tooltipText]="isMobile ? '' : item.content"
								[isResultTitle]="true">
								{{ item.content }}
							</span>
						</div>
						<mat-icon class="keyboard-arrow-icon">
							<ng-container *ngIf="isPanelOpen(index); else closePanel">keyboard_arrow_up</ng-container>
							<ng-template #closePanel>keyboard_arrow_down</ng-template>
						</mat-icon>
					</div>
				</mat-panel-title>
			</mat-expansion-panel-header>
			<div class="result-top-container" fxLayout="column" fxLayoutGap="8px">
				<div class="result-container" fxLayout="column" fxLayoutGap="2px">
					<div class="result-header" fxLayout="row" fxLayoutAlign="space-between center">
						<span class="title" i18n>How frequently the phrase was found in our dataset :</span>
						<mat-icon
							class="info-icon"
							fontSet="material-icons-outlined"
							#tooltipResult="matTooltip"
							[tabIndex]="0"
							[matTooltip]="resultTooltipText"
							[matTooltipPosition]="'before'"
							(click)="isMobile ? toggleTooltip(tooltipResult) : redirectToAIInsightsInfo()"
							matTooltipClass="web-report-mat-tooltip tooltip-contanier">
							info
						</mat-icon>
					</div>
					<div class="ai-count-container" fxLayout="row" fxLayoutAlign="space-between center">
						<span class="title" i18n>AI Text</span>
						<span class="count-result" i18n>
							{{ item.aiCount | formaDecimalNumber }} occurrences per 1 million documents
						</span>
					</div>
					<div class="human-count-container" fxLayout="row" fxLayoutAlign="space-between center">
						<span class="title" i18n>Human Text</span>
						<span class="count-result" i18n>
							{{ item.humanCount | formaDecimalNumber }} occurrences per 1 million documents
						</span>
					</div>
				</div>
				<span class="result-number-explain" i18n>*Decimals are hidden for numbers greater than 1.</span>
			</div>
		</mat-expansion-panel>
	</mat-accordion>
</ng-template>
